# -*- coding: utf-8 -*-
"""Untitled9.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14ef0fU0K3nbmX8nx88-3nXu8PyjwN4_s
"""

import streamlit as st
import zipfile
import random
import os

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’åˆæœŸåŒ–
if "questions" not in st.session_state:
    st.session_state.questions = []
if "current_q" not in st.session_state:
    st.session_state.current_q = 0
if "score" not in st.session_state:
    st.session_state.score = 0

uploaded_file = st.file_uploader("æ›²ãƒ‡ãƒ¼ã‚¿ã®ZIPã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„", type="zip")

if uploaded_file and not st.session_state.questions:
    with zipfile.ZipFile(uploaded_file, "r") as z:
        wav_files = [f for f in z.namelist() if f.endswith(".wav")]
        random.shuffle(wav_files)
        # æœ€å¤§100å•ã«åˆ¶é™
        st.session_state.questions = wav_files[:100]

if st.session_state.questions:
    current_idx = st.session_state.current_q
    chosen_file = st.session_state.questions[current_idx]

    with zipfile.ZipFile(uploaded_file, "r") as z:
        with z.open(chosen_file) as f:
            audio_bytes = f.read()

    # éŸ³å£°å†ç”Ÿï¼ˆ1å›ã ã‘æµã™ï¼‰
    st.audio(audio_bytes, format="audio/wav")

    correct_title = os.path.splitext(os.path.basename(chosen_file))[0]
    st.write(f"ãƒ’ãƒ³ãƒˆ: {len(correct_title)}æ–‡å­—")

    answer = st.text_input("æ›²åã‚’ã²ã‚‰ãŒãªã§å…¥åŠ›", key=f"answer_{current_idx}")

    if st.button("å›ç­”ã™ã‚‹"):
        if answer == correct_title:
            st.success("æ­£è§£ï¼")
            st.session_state.score += 1
        else:
            st.error(f"ä¸æ­£è§£ï¼ æ­£è§£ã¯ {correct_title}")

        # æ¬¡ã®å•é¡Œã¸
        st.session_state.current_q += 1

        # å…¨éƒ¨çµ‚ã‚ã£ãŸã‚‰çµæœè¡¨ç¤º
        if st.session_state.current_q >= len(st.session_state.questions):
            st.write("ğŸ‰ ã‚¯ã‚¤ã‚ºçµ‚äº†ï¼")
            st.write(f"ã‚¹ã‚³ã‚¢: {st.session_state.score} / {len(st.session_state.questions)}")
            st.session_state.current_q = 0
            st.session_state.questions = []